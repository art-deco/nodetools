##! Babel R U OK

That's the title of [an issue that I opened](r-u-ok) in _Babel_'s repository after I discovered one of the most devastating bugs in the entire _Node.JS_ ecosystem. I already wasn't happy with having to use a transpiler with 265 transient dependencies (via npm, 250 via yarn) for every package that I created just because I liked the `import` syntax and believed that it was essential to follow the modern day standard. Although with an SSD and fibre-optics it doesn't take that long to download and link dependencies and rebuild `fsevents` (still takes about 30s), in summer 2018 I was downshifting from Sky to mobile 3G and became conscious of inbound/outbound data, as well as worked on an older iMac with a standard hard drive. Therefore, every new package I started took a few minutes to initialise due to all linking that had to be done against Babel's bloatware (the `linking N...` number actually grows exponentially). But what I found about this popular transpiler in August that year, really upset me.

_So let's take an example that uses ES6 modules, i.e., the JS standard [since mid 2015](history):_

<highlightjs src="./example/babel.mjs" />

Above is just an example code with a default export followed by 3 named exports which are functions with _JSDoc_ annotations. _JSDoc_ is just as important as the code itself, especially for complex programs that accept configs, so that developers who consume our package (and more importantly, ourselves), can use it easily, receive access to autocompletion hints and feel secure that they work process is correct. _JSDoc_ is crucial for productivity and developer experience, so we usually pay a lot of attention to documenting our code.

The source however needs to be transpiled since imports and exports are not understood. The convention is to use _Babel_. My setup is minimal required to transpile imports/exports, with `@babel`'s core, cli, and transform plugin (latest versions as of 1 Feb 2020). Just to enable modules, I need to install about 250 dependencies, but that's half the trouble.

```json
{
  "name": "shmable",
  "scripts": {
    "b": "babel src -d build"
  },
  "dependencies": {
    "@babel/cli": "^7.8.4",
    "@babel/core": "^7.8.4",
    "@babel/plugin-transform-modules-commonjs": "^7.8.3"
  }
}
```

<details><summary>
_And see how it is compiled:_

```js
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.shmable = exports.transpile = exports.stable = exports.default = void 0;

var _stream = _interopRequireWildcard(require("stream"));

// ˅ ˅ ˅ CLICK TO EXPAND ˅ ˅ ˅
```
</summary>

<highlightjs src="./example/compiled.mjs" />
</details>

The code looks ugly but since every JS developer trusts _Babel_ so much (why not, the fact that it's got 50m monthly downloads means it's reliable, doesn't it?), there's no need to ever look into the "build" folder. Can you spot any problems with that code?. It's OK if not, I couldn't either, and that was partly because I'm using _VS Code_ as my IDE. You can't spot any problems during testing, or writing examples because when importing functions from source code, _VSCode_ will statically analyse source code and not transpiled code for your developer experience (notice proper _JSDoc_ description for functions on the demo below).

<p>
  <img border rounded img-fluid src="./img/src-jsdoc.gif" alt="no problem within package" placeholder-auto />
</p>

The problems start, when we publish the package with transpiled code, and require it from other packages. I call my new bug example package <npm-badge package="shmable">_shmable_</npm-badge>, which you can install yourself.

<!-- No issues can be seen when requiring source for testing within the package directory, since _JSDoc_ annotations to functions work fine when importing ES6 source code for testing. Problems only start after publishing the package, installing it in other packages, and requiring the TRANSPILED code in them. -->

So what's actually happened here? Well, in the first instance, arguments for the default `TechNation` import are shown only because _VS Code_ infers the type using the *NAME* of the variable in the target source, rather than understanding what's actually exported/imported. The fact that it's broken when the name changes proves that. The editor doesn't know what the default import is, it just knows the name of the variable and does the Maths. It's quite difficult to come across this, because typically the name of the default export is also the name of the default import. It was only when I imported a variable using a different name that I noticed it wasn't working. This bug has been fixed since TypeScript 3.2 (October 2018) after my [bug report](https://github.com/microsoft/TypeScript/issues/25854) by TypeScript checking for the assignment of `__esModule` and picking up the `default` export. Nonetheless, the IDE still doesn't show hints for the `sucks` method. Why?

<details><summary>_Let's have a look again at the transpiled code generated by _Babel_ after about the middle of the file:_

```js
/**
 * The method used by Tech Nation for libel.
 * @param {string} to Whom to lie.
 */


const expert = (to = 'Home Office') => {
  console.log('Lie to %s', to);
};
// ˅ ˅ ˅ CLICK TO EXPAND UNTIL THE END ˅ ˅ ˅
```
</summary>

```js
/**
 * The method used by Tech Nation for libel.
 * @param {string} to Whom to lie.
 */


const expert = (to = 'Home Office') => {
  console.log('Lie to %s', to);
};
/**
 * Proves that the pseudo-endorsing is useless.
 * @param {string} resistance The name of opposition.
 * @param {boolean} willWin Whether results will be achieved.
 */


exports.expert = expert;

const sucks = (resistance = 'Art Deco', willWin = true) => {
  console.log('%s: fighting for freedom.', resistance);
};
```
</details>

See the problem? The transpiler generated and inserted the `exports.expert` assignment, separating _JSDoc_ for the `sucks` method from the actual function, preventing any in-editor documentation from being shown to developers! That's causing so much harm to everyone, especially _Node.JS_ package makers who are diligently documenting their code, trying to make it appealing to other developers. In other words, I'm carefully and honestly writing my _JSDoc_ for all methods, just for the tool that I put my trust in (while having to tolerate ~5k linking dependencies), to effortlessly destroy all my efforts! WHAT. A. SHAME.

<section-break />

##! Incorrect placement of JSDoc comments #8437

That's [the title and number of the second issue](https://github.com/babel/babel/issues/8437) because the first one was removed since it was "insulting". In *BABEL R U UK* I didn't use swear words to call authors names to make it insulting, it was primary "all caps", or what can be considered _raising the voice at maintainers_ for that bug asking them how can they do that to me and others. It just made me really angry because

<ul>
  - I'm a Senior Software Developer with a BSc/Master degrees in Computer Science yet you don't get no respect for that amongst everyone else who calls themselves developers on the web when Computer Science is not even their specialisation;
  - I'm passionate and obsessional about quality;
  - I finally understood why _JSDoc_ was not showing in the editor properly for my own packages;
  - There's nobody who would tell them off for that offense, there's no Open Source quality assurance commission that would shame an essential piece of _Node.JS_ infrastructure for how they treated me and my work. What there is, is Handshake who gave them a $100k cheque simply because they are so known.
  - Follows from the above, what about taking some responsibility instead of only bragging about how many people use the software?
</ul>

It finally established my attitude towards so-called "community" where no responsibility is ever taken by anyone and my *freedom* of writing documentation using _JSDoc_ was taken away from me by software that pretty much extorted me into using it because of lack of alternatives and _Node.JS_'s inability to JUST make ES6 modules happen. Let's have a look at the the first comment from a maintainer on that issue:

<row mb-3 class="markdown-body">
  <col sm-1>
    <img img-fluid alt="demurgos avatar" src="https://avatars2.githubusercontent.com/u/2262218?s=88&v=4" />
  </col>
  <col style="border-radius: 3px; padding-right:0; padding-left:0; margin-right: 15px; border: 1px solid #e1e4e8!important;">
    <table>
      <tr>
        <td class="timeline-comment-header">
        [demurgos](https://github.com/demurgos) commented on 8 Aug 2018 •
        </td>
      </tr>
      <tr><td p-3>
      Your previous issue was closed because its tone was insulting. This one is too: it's not just about avoiding all-caps. Babel is used by thousands of production-grade projects, many of which use doc comments to generate their documentation. With a bit of humility, you may have recognized that maybe you are missing something instead of immediately calling the maintainers incompetent.<br><br>
      Now, to answer you issue: the output you see is expected behavior (*Edit*: See below, I agree that it's worse than in Babel 6). Output generated by Babel is no longer source code (by definition, it's generated content): it is not intended to act as source code. Comments are emitted on a best effort basis to help readability when debugging the output file. Babel output should be treated similarly to machine code: you do not generate documentation from machine code but from the source.<br><br>
      The input you pass to your documentation generation tool should be the the source code with ES-next syntax, not the lowered Babel output.
      </td></tr>
    </table>
  </col>
</row>

My reply was that I wasn't calling the _maintainers_ incompetent, but all people who blindly make religion out of Babel without knowing what they are doing (_though it's what I was also doing, but then I stopped, whereas have you?_). The comment was marked as disruptive and fair enough. You can talk to the person mentioned here and he'll confirm that I reached out to him and apologized for overflow of emotions. In the "disruptive" comment I only made it clear that he misunderstood the point that I made regarding _JSDoc_ blocks (hence _edit_ in his comment) and that it's not generated documentation that suffered, but actual transpiled code. But he says himself *Babel is used by thousands of production-grade projects, many of which use doc comments to generate their documentation*!!! There's no better words than - What the **** Babel -. _demurgos_ continues:

<block-quote style="background: #fff6c5;">I also want to remind you that Babel is supported by a small team of volunteers. If you want to improve things, you can help and send PRs. You are not entitled to free support and insults are not tolerated.</block-quote>

<p><img alt="Babel Open Collective landing: £300.000 yearly budget." img-fluid src="img/one-year/babel.png"/></p>
<p><img alt="Babel Maintainer getting paid $15.000 in August" img-fluid src="img/one-year/free-support1.png"/></p>
<p><img alt="Babel Maintainer getting paid $8.000 in August" img-fluid src="img/one-year/free-support2.png"/></p>


OK perhaps I'm not entitled to support unless I contribute moneys, but the [Open Collective](https://opencollective.com/babel) page states that 2 hours of support goes only to the most advanced contribution tier, called "Base Support Sponsor" for $24k a year. OK Babel you've charged _AirBnb_ and _AMP_ for 4 hours of your support $4k in August ($1k per hour, but that's none of my business really how much you charge for support, I'm actually happy you can do that, what I'm mad about is how you betray trust of all other people who contribute money without being entitled to support), so the rest $19k must have been spent on maintenance, such as fixing bugs?

<block-quote style="background: #fff6c5;">Looking at it closer, this seems to be a regression introduced during the Babel 7 beta.<br>
A simple workaround would be to use a stable version of Babel (Babel 6).<br>
It's not good that this regression happened, but it's why Babel 7 is still in *beta*. Thanks for reporting issues on the beta release, but there's *no need to get mad if you use unstable versions*. This will probably be fixed until the stable release.</block-quote>

<plate alt="babel issue comment complaining about non-beta version" src="img/one-year/unstable.png">Unstable version they say... Babel 7 went out of beta since actually August 27, 2018.</plate>
<plate alt="babel issue comment saying how a person had to change entire built system to typescript because of babel" src="img/one-year/alamode/typescript.png">Just as I was writing this article, another comment appeared highlighting exactly all of my concerns here! Sometimes I believe in God!</plate>

<p><img alt="2 Babel maintainers getting paid almost $100.000 on Open Collective" class="img-fluid" src="img/one-year/100k.png"/></p>

I will abstain from commenting further because then this entire page will have to be marked as "disruptive", towards both "volunteers" (maintainers <small>cashing in 10k a month khm-khm each</small>) and contributors willing to pay this money for such reliable software. Is it really wrong of me to show negative attitude towards this state of affairs? Just one last thing I want to bring up here, is that the Babel's maintainers get "to be involved in the process that moves various JavaScript proposals forward" (Open Collective's landing). Yet we have bugs like that. I believe it's essential to have traditional values met first, before working on proposals, and _Babel_ was responsible however it failed. For comparison, *Bootstrap* [receives](https://opencollective.com/bootstrap) only £3k yearly, arguably being the second most important piece of the web infrastructure after _Babel_. A picture is worth a thousand words:

<p>
  <img alt="Balmer: Babel Babel Babel TypeScript" img-fluid src="./img/balmer.gif"/>
</p>

<section-break />

##! Promise&lt;Open Source&gt;.reject()

Going back to the _the promise of open source is better quality, higher reliability, more flexibility, lower cost, and an end to predatory vendor lock-in_, so far we can draw the following conclusions:

<ul>
  - *Better quality* is not a thing since _JSDoc_ is essential to the development process. You can't not have functions annotated properly (`@param`, an occasional `@example`) if you publish your package. A transpiler MUST keep _JSDoc_ in the proper place, if it doesn't that means the transpiler is of low-quality since it doesn't even have tests for _JSDoc_.
  - *Higher reliability* is a myth because even though the issue was filed, with screenshots and explanations, it was ignored totally for the amount of time equal to one year, even after the software went out of beta-testing.
  - *Lower cost* is actually higher, because installing _Babel_ will increase the `npm install` duration of each new dependency for up to a 20-30s, and much more on hard drives (compared to SSD). Say 5 installs a day of new packages in a team of 5 people, that's 12 minutes a day and an hour a week wasted on looking at the "linking dependencies..." message.
  - and finally, perhaps the most unintuitively, *an end to predatory vendor lock-in* becomes...
</ul>

<!-- end section -->
</div>
<!-- <section-break/> -->


 <!-- and uses the same brainwashing techniques that games use ([addictions article on GNU](https://www.gnu.org/proprietary/proprietary-addictions.html)). -->

<!-- <ul>
  <li>_The Skinner Box_: TypeScript keeps you addicted to typing every singly thing, you will strive for 100% coverage just for the sake of it. In TypeScript defence, that's not just it's </li>
  <li>_Virtual food pellets_: You will want to create types for all possible edge cases, even though .</li>
</ul> -->