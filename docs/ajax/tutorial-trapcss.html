{
  "title": "Tutorial: TrapCSS",
  "content": "\n\n<div data-section id=\"trapcss\">\n<h1 id=\"trapcss-nodetools-use-case\">TrapCSS: NodeTools Use Case</h1>\n\n<p>There are CSS frameworks such as <em>Bootstrap</em> that allow to create great layouts quickly, however their size might be quite large. This point is worth considering because CSS is loaded in a blocking fashion: the browser will have to wait before all CSS is loaded to render a web site, which slows page render, and affects usability and even search engine ranking negatively. In many cases, a lot of CSS can be \"dropped\" from frameworks' compiled code, and by leaving only those selectors that are present on a page, or multiple pages. This technique corresponds to the \"Defer unused CSS\" Lighthouse <a href=\"https://developers.google.com/web/tools/lighthouse/audits/unused-css\">warning</a>.</p>\n\n<p>\n  <img class=\"ImageHolder rounded img-fluid\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 540px,(max-width: 1199.8px) 720px,855px\" alt=\"trap css nodetools tutorial\" src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1000' height='674'/%3E\">\n  <noscript>\n    <picture>\n      <source\n        srcset=\"/nodetools/pages/trapcss/img/splash-768.webp 768w,/nodetools/pages/trapcss/img/splash-576.webp 576w,/nodetools/pages/trapcss/img/splash-319.webp 319w,/nodetools/pages/trapcss/img/splash-1000.webp 1000w\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 540px,(max-width: 1199.8px) 720px,855px\"\n        type=\"image/webp\">\n      <img class=\"rounded img-fluid\" onLoad=\"webploaded(this)\" alt=\"trap css nodetools tutorial\" src=\"/nodetools/pages/trapcss/img/splash-768.jpg\" srcset=\"/nodetools/pages/trapcss/img/splash-768.jpg 768w,/nodetools/pages/trapcss/img/splash-576.jpg 576w,/nodetools/pages/trapcss/img/splash-319.jpg 319w,/nodetools/pages/trapcss/img/splash-1000.jpg 1000w\" sizes=\"(max-width: 575.8px) 100vw,(max-width: 991.8px) 540px,(max-width: 1199.8px) 720px,855px\">\n    </picture>\n  </noscript>\n</p>\n\n<p>One of the packages that is able to do it quickly is called <a href=\"https://github.com/leeoniya/dropcss\">DropCSS</a>, developed by <a href=\"https://github.com/leeoniya\">Leon Sorokin</a>. It's notable for its speed, simplicity and the amount of bytes that can shaved off the CSS. However, for our use case it was not perfect: it strips comments and does not allow to keep arbitrary annotations, such as <span class=\"tm\">/* alternate */</span> which is needed for <a href=\"https://github.com/artdecocode/closure-stylesheets-java\">Closure Stylesheets</a>. Closure Stylesheets is an optimiser of CSS that can minify and put styles together. Art Deco uses it for Splendid, a static website generator. By collecting selectors across all pages on a generated website, we're able to drop unused Bootstrap rules, and then merge Bootstrap with other styles so that a single, small CSS file is served to visitors quickly.</p>\n\n<p>But Bootstrap contains rules that repeat the CSS properties, e.g.,:</p>\n\n<pre id=\"c1d47\"><code class=\"css hljs\">abbr[title],\nabbr[data-original-title] {\n  text-decoration: underline;\n  -webkit-text-decoration: underline dotted;\n  /* @alternate */\n  text-decoration: underline dotted;\n  /* ^ repeated use, need alternate */\n}</code></pre>\n\n<p>We needed to annotate Bootstrap with the <span class=\"tm\">/* alternate */</span> marker so that the CSS compiler doesn't throw an error. A simple proposed solution to prevent stripping such comments was suggested in form of a <a href=\"https://github.com/leeoniya/dropcss/pull/41\">PR</a> to <em>DropCSS</em> package owner, however was rejected as being too narrow of a use case. Therefore, we decided to fork his project and use its source code to create a professional Node.JS package that would also provide JSDoc annotations, could be tested with context testing, and is ready to be compiled into other packages, such as <em>Splendid</em> itself, so that it's linked statically instead of dynamically as permitted by the original MIT license.</p>\n\n<p>This tutorial walks through the process of upgrading a package to use <em>NodeTools</em> stack with explanation of advantages of using the tools from the stack in creating modern packages.</p>\n\n<p class=\"SectionBreak\">\n  <a title=\"Back To Top\" href=\"#top\">\n    <img alt=\"section break\"\n      src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='15'/%3E\" data-io>\n    <noscript><img alt=\"section break\" src=\"/nodetools/section-breaks/0.svg\"></noscript></a>\n</p>\n</div>",
  "file": "trapcss",
  "postAjax": "(function imgPostAjax() {\n  /* eslint-env browser */\n  window['IO']()\n  window['WEBP']()\n})()"
}